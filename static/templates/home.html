<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</title>
  <script src="/static/js/notifications.js"></script>
  <style>
    .notification {
      padding: 10px;
      margin-bottom: 5px;
      border: 1px solid #ccc;
      background-color: #f8f8f8;
    }
  </style>
</head>
<body>
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!</h1>
  <div id="notifications"></div>

  <script>
    // –ü–æ–ª—É—á–µ–Ω–∏–µ userID –∏–∑ Go-—à–∞–±–ª–æ–Ω–∞ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
    const userID = {{ if . }}{{ . }}{{ else }}1{{ end }};
    const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDQ4MTk3MDAsInJvbGUiOiJidXllciIsInVzZXJfaWQiOjF9.ff_DINj3tG2JJ-1aevAlbOoJm6MI2KRgaPSmg-U6mfM'; // üîê access_token –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

    function connectToSSEWithToken(userID, token) {
      if (!userID) {
        console.error("–ù–µ—Ç userID –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SSE");
        return;
      }

      if (window.sseConnection) {
        console.log("‚ö†Ô∏è SSE —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ");
        return;
      }

      let sseUrl = `http://localhost:8079/sse/${userID}`;
      if (token) {
        sseUrl += `?access_token=${token}`;
      }

      console.log("üîå –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ SSE:", sseUrl);
      const sse = new EventSource(sseUrl);
      window.sseConnection = sse;

      sse.onmessage = function(event) {
        console.log("üîî –°–æ–æ–±—â–µ–Ω–∏–µ:", event.data);
    };


      sse.onerror = function(err) {
        console.error("SSE –æ—à–∏–±–∫–∞:", err);
        sse.close();
        window.sseConnection = null;
      };
    }

    connectToSSEWithToken(userID, token);
  </script>
</body>
</html>
